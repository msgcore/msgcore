# Email Platform Guide (SMTP)

## Overview

MsgCore now supports **Email via SMTP**, allowing you to send emails through any SMTP server (Gmail, Outlook, custom domains, etc.).

## Features

‚úÖ **Send emails** with rich HTML formatting
‚úÖ **Attachments** (up to 25MB for Gmail, 10MB for Outlook)
‚úÖ **Embeds** converted to beautiful HTML email templates
‚úÖ **Buttons** rendered as clickable links
‚úÖ **Auto-subject extraction** from first line of message
‚úÖ **Connection pooling** for performance
‚úÖ **SMTP verification** on connection creation

## Quick Start

### 1. Configure Email Platform

**Using API:**

```bash
curl -X POST "https://api.msgcore.dev/api/v1/projects/YOUR_PROJECT/platforms" \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "platform": "email",
    "credentials": {
      "smtpHost": "smtp.gmail.com",
      "smtpPort": 587,
      "smtpSecure": false,
      "smtpUser": "your-email@gmail.com",
      "smtpPassword": "your-app-password",
      "fromEmail": "your-email@gmail.com",
      "fromName": "My Bot"
    }
  }'
```

### 2. Send an Email

```bash
curl -X POST "https://api.msgcore.dev/api/v1/projects/YOUR_PROJECT/messages/send" \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "targets": [{
      "platformId": "PLATFORM_ID",
      "type": "user",
      "id": "recipient@example.com"
    }],
    "content": {
      "text": "Meeting Reminder\n\nDon't forget our meeting tomorrow at 10 AM!"
    }
  }'
```

## SMTP Provider Setup

### Gmail

**Requirements:**
- Enable 2FA on your Google account
- Generate an **App Password** (not your regular password)

**Credentials:**
```json
{
  "smtpHost": "smtp.gmail.com",
  "smtpPort": 587,
  "smtpSecure": false,
  "smtpUser": "your-email@gmail.com",
  "smtpPassword": "your-app-password",
  "fromEmail": "your-email@gmail.com",
  "fromName": "Bot Name"
}
```

**Limits:** 500 emails/day per account

**How to get App Password:**
1. Go to [Google Account Security](https://myaccount.google.com/security)
2. Enable 2-Step Verification
3. Search for "App Passwords"
4. Generate password for "Mail"
5. Copy the 16-character password

---

### Outlook / Hotmail

**Credentials:**
```json
{
  "smtpHost": "smtp-mail.outlook.com",
  "smtpPort": 587,
  "smtpSecure": false,
  "smtpUser": "your-email@outlook.com",
  "smtpPassword": "your-password",
  "fromEmail": "your-email@outlook.com",
  "fromName": "Bot Name"
}
```

**Limits:** 300 emails/day per account

---

### Custom Domain (cPanel, Namecheap, etc.)

**Credentials:**
```json
{
  "smtpHost": "mail.yourdomain.com",
  "smtpPort": 465,
  "smtpSecure": true,
  "smtpUser": "bot@yourdomain.com",
  "smtpPassword": "your-password",
  "fromEmail": "bot@yourdomain.com",
  "fromName": "Bot Name"
}
```

**Common Ports:**
- `465` ‚Üí SSL/TLS (set `smtpSecure: true`)
- `587` ‚Üí STARTTLS (set `smtpSecure: false`)
- `25` ‚Üí Plain (not recommended, often blocked)

---

## Advanced Features

### Rich HTML Emails with Embeds

```json
{
  "targets": [{
    "platformId": "PLATFORM_ID",
    "type": "user",
    "id": "user@example.com"
  }],
  "content": {
    "text": "Weekly Report",
    "embeds": [{
      "title": "Sales Dashboard",
      "description": "Your weekly performance summary",
      "color": "#5865F2",
      "fields": [
        { "name": "Revenue", "value": "$12,450" },
        { "name": "New Customers", "value": "47" }
      ],
      "imageUrl": "https://example.com/chart.png",
      "footer": { "text": "Generated by MsgCore" },
      "timestamp": "2025-10-03T12:00:00Z"
    }]
  }
}
```

**Result:** Beautiful HTML email with styled embed card.

---

### Attachments

```json
{
  "targets": [{
    "platformId": "PLATFORM_ID",
    "type": "user",
    "id": "user@example.com"
  }],
  "content": {
    "text": "Invoice Attached",
    "attachments": [{
      "url": "https://example.com/invoice.pdf",
      "filename": "invoice-2025-10.pdf"
    }]
  }
}
```

**Or use base64:**

```json
{
  "attachments": [{
    "data": "data:application/pdf;base64,JVBERi0xLjQKJeLj...",
    "filename": "report.pdf"
  }]
}
```

---

### Buttons (HTML Links)

```json
{
  "content": {
    "text": "Action Required",
    "buttons": [
      { "text": "Approve", "url": "https://app.example.com/approve/123" },
      { "text": "Reject", "url": "https://app.example.com/reject/123" }
    ]
  }
}
```

**Result:** Styled HTML buttons in email.

---

## Email Format

### Subject Line Extraction

MsgCore automatically extracts the **first line** of your message as the email subject:

**Input:**
```
"Meeting Tomorrow\n\nJoin us at 10 AM for the quarterly review."
```

**Result:**
- **Subject:** "Meeting Tomorrow"
- **Body:** "Join us at 10 AM for the quarterly review."

**Auto-truncation:** Subjects longer than 80 characters are truncated with "..."

---

### HTML Email Template

All emails are sent with **both plain text and HTML versions** for maximum compatibility:

- **Plain text:** Direct message content
- **HTML:** Responsive email template with inline CSS
- **Max width:** 600px (optimal for email clients)
- **Mobile-friendly:** Responsive design

---

## Troubleshooting

### "Failed to verify SMTP connection"

**Causes:**
- Wrong host/port combination
- Invalid credentials
- Firewall blocking SMTP ports
- Gmail: Need App Password (not regular password)

**Solutions:**
1. Verify SMTP settings with your email provider
2. Test credentials with a dedicated email client first
3. Check if your hosting/network allows SMTP

---

### "Invalid email address"

**Cause:** Recipient email doesn't match format `user@domain.com`

**Solution:** Use valid email addresses (validated with regex)

---

### Rate Limiting

**Gmail:** 500/day ‚Üí Spread sending over time or use multiple accounts
**Outlook:** 300/day ‚Üí Same as above
**Custom SMTP:** Check your hosting plan limits

---

## Security Best Practices

### Credentials Storage

‚úÖ **MsgCore encrypts** all SMTP credentials with AES-256-GCM
‚úÖ Credentials **never** stored in plain text
‚úÖ Environment variables for encryption key (`ENCRYPTION_KEY`)

### App Passwords

üîê **Always use App Passwords** for Gmail/Google Workspace
üîê **Never** use your main account password
üîê **Revoke immediately** if compromised

### Email Validation

‚úÖ MsgCore validates email format before sending
‚úÖ **XSS Protection:** All HTML content is escaped
‚úÖ **SSRF Protection:** Attachment URLs validated

---

## Limitations

### Platform-Specific

| Feature | Supported | Notes |
|---------|-----------|-------|
| **Send Messages** | ‚úÖ Yes | Via SMTP |
| **Receive Messages** | ‚ùå No | SMTP is send-only (IMAP support planned) |
| **Reactions** | ‚ùå No | Not supported in email |
| **Edit Messages** | ‚ùå No | Email is immutable |
| **Delete Messages** | ‚ùå No | Can't unsend emails |
| **Threads** | ‚ö†Ô∏è Partial | Use subject lines and In-Reply-To headers |

### Size Limits

- **Gmail:** 25MB total (message + attachments)
- **Outlook:** 10MB total
- **Custom SMTP:** Varies by provider

---

## Capabilities

Query platform capabilities:

```bash
GET /api/v1/platforms/health
```

**Response:**
```json
{
  "email": {
    "healthy": true,
    "capabilities": [
      {
        "capability": "send-message",
        "supported": true
      },
      {
        "capability": "attachments",
        "supported": true,
        "limitations": "Max 25MB (Gmail), 10MB (Outlook), varies by provider"
      },
      {
        "capability": "embeds",
        "supported": true,
        "limitations": "Converted to HTML email format"
      }
    ]
  }
}
```

---

## Example Use Cases

### 1. Notification System
Send alerts, reminders, and updates to users via email.

### 2. Transactional Emails
Order confirmations, password resets, invoices.

### 3. Newsletter Distribution
Broadcast updates to subscriber lists (respect rate limits).

### 4. Report Delivery
Automated daily/weekly reports with attachments.

### 5. Two-Factor Authentication
Send OTP codes (but use dedicated services for production).

---

## Future Enhancements

**Planned features:**

- üîÑ **IMAP Support** ‚Üí Receive emails
- üìß **SendGrid/Mailgun Adapters** ‚Üí Better deliverability for high volume
- üìä **Delivery Tracking** ‚Üí Open/click tracking webhooks
- üé® **Custom Templates** ‚Üí Reusable HTML email templates
- üìÖ **Scheduled Sending** ‚Üí Send emails at specific times

---

## Support

**Need help?**

- **Documentation:** https://docs.msgcore.dev
- **Discord:** https://discord.gg/bQPsvycW
- **GitHub Issues:** https://github.com/filipexyz/msgcore

---

## Summary

‚úÖ **SMTP-only** (simple, free, works everywhere)
‚úÖ **No vendor lock-in** (use any SMTP server)
‚úÖ **Rich features** (HTML, embeds, attachments, buttons)
‚úÖ **Production-ready** (26 passing tests, encrypted credentials)
‚úÖ **Zero cost** (15k emails/month free with Gmail)

**Ready to send emails? Configure your platform now!** üöÄ
